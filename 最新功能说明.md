# 🚀 ChatGPT Team 自动管理系统 - 功能说明

本系统是一个基于 Flask 的 ChatGPT Team 账号池自动化管理平台，旨在解决多 Team 账号管理难、邀请繁琐、成员控制不便等问题。系统通过逆向 API 实现了自动邀请、负载均衡、自动踢人及安全防护等高级功能。

---

## 🌟 核心功能亮点

### 1. 🧠 智能负载均衡与高可用邀请

系统维护一个 Team 账号池，用户使用邀请码时，系统会自动进行智能分配：

-   **智能择优**：优先选择未满员（<4 人）、Token 健康且**最近邀请成功**的 Team，命中率更高。
-   **故障转移**：如果首选 Team 邀请失败（如风控限制），系统会自动重试其他可用 Team（最多尝试 3 次）。
-   **双重验证**：邀请发出后，系统会自动检查 Team 的 Pending 列表，确保邀请真实送达。
-   **智能去重**：如果用户邮箱已在某个 Team 中，系统会直接识别并返回成功，避免重复操作。

### 2. �️ 账号池健康守护与监控

全方位的 Token 状态监控，确保账号池稳定运行：

-   **Token 自动保活**：
    -   **自动计数**：连续 5 次 API 调用失败自动标记 Token 为 `expired`（过期），不再分配新用户。
    -   **独立监控**：成员检查接口拥有独立错误计数（10 分钟内失败 >3 次标记过期），防止因单一接口风控影响全局。
    -   **自动恢复**：一旦更新 Token 或请求成功，系统会自动重置错误计数，恢复 Team 活性。
-   **批量维护**：支持一键清理所有 Token 已过期的 Team。

### 3. 🤖 高性能自动踢人系统

全自动化的成员生命周期管理，保护账号安全，支持高并发：

-   **并发检测**：采用多线程并发机制（默认 3 线程），大幅提升大规模账号池的检测速度。
-   **安全运行**：
    -   **随机延迟**：任务提交增加随机延迟（0.3-0.5 秒），避免瞬时高并发触发官方风控。
    -   **拟人化**：检测间隔随机波动（如 90-120 秒），支持设置运行时间段（如 09:00 - 22:00）。
-   **非法清理**：自动识别并踢出未通过系统邀请的“偷渡”成员（自动跳过 Team Owner）。
-   **过期清理**：自动识别并踢出过期的临时邀请成员。

### 4. 🔑 灵活的邀请码系统

-   **多类型支持**：
    -   **通用码**：不绑定特定 Team，由系统智能分配。
    -   **绑定码**：绑定特定 Team，用于定向邀请或补充特定 Team 成员。
    -   **临时码**：设置有效期（如 24 小时），到期后系统自动踢出成员。
-   **批量生成**：支持批量生成邀请码，满足大规模分发需求。

### 5. � 邮件与通知服务

-   **SMTP 邮件集成**：支持配置 SMTP 服务器（如 QQ 邮箱、Gmail），发送邀请成功通知、使用教程等。
-   **Bark 推送**：支持配置 Bark URL，将关键系统事件推送到管理员手机。
-   **自定义公告**：管理员可在后台配置 Team 页面弹窗公告，向用户传达重要信息。

### 6. 🛠️ 高级管理功能

-   **智能导入**：
    -   通过 Session JSON 一键添加 Team。
    -   自动识别 `organization_id`，如果 Team 已存在则自动更新 Token 和信息，避免重复数据。
-   **反向查询**：支持通过用户邮箱反查其所在的 Team。
-   **安全防护**：
    -   **Fail2Ban**：管理员登录防爆破（5 次错误封禁 30 分钟）。
    -   **指纹伪造**：内置 `curl_cffi` 库，模拟真实 Chrome 浏览器指纹，降低 API 被拦截风险。

---

## 📖 使用指南

### 1️⃣ 添加/更新 Team

1.  登录 ChatGPT 官网，访问 `https://chatgpt.com/api/auth/session` 获取 JSON。
2.  在管理后台 **"➕ 添加新 Team"** 处粘贴 JSON。
    -   系统会自动解析并创建/更新 Team。

### 2️⃣ 生成邀请码

1.  进入 **"🔑 邀请码池"**。
2.  点击 **"生成邀请码"**。
    -   选择数量（支持批量）。
    -   可选择是否绑定特定 Team。
    -   可选择是否为“临时邀请”（设置小时数）。

### 3️⃣ 配置自动踢人

1.  在 **"🤖 自动踢人配置"** 卡片中启用。
2.  系统将以多线程方式在后台自动守护。

### 4️⃣ 用户加入

1.  用户访问系统首页，输入 **邮箱** 和 **邀请码**。
2.  系统自动择优分配 Team，邀请成功后发送邮件通知（如已配置邮件服务）。

---

## ⚠️ 注意事项

-   **Team 人数上限**：每个 ChatGPT Team 只有 4 个席位（不含 Owner）。
-   **并发设置**：自动踢人服务已优化并发，但建议 Team 数量极多（>100）时适当调整检测间隔。
-   **反爬虫策略**：建议不要设置过短的检测间隔，以免触发官方限流。

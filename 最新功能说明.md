# 🚀 ChatGPT Team 自动管理系统 - 最新功能说明

本系统是一个基于 Flask 的 ChatGPT Team 账号池自动化管理平台，旨在解决多 Team 账号管理难、邀请繁琐、成员控制不便等问题。系统通过逆向 API 实现了自动邀请、负载均衡、自动踢人及安全防护等高级功能。

---

## 🌟 核心功能亮点

### 1. 🧠 智能负载均衡与自动分配

系统维护一个 Team 账号池，用户使用邀请码时，系统会自动进行智能分配：

-   **自动择优**：优先选择未满员（<4 人）、Token 有效且最近活跃的 Team。
-   **故障转移**：如果首选 Team 邀请失败（如风控限制），系统会自动重试其他可用 Team（最多尝试 3 次）。
-   **智能去重**：如果用户邮箱已在某个 Team 中，系统会直接识别并返回成功，避免重复操作。

### 2. 🔑 强大的邀请码系统

告别传统的一码一号模式，全新的邀请码池系统：

-   **解耦设计**：邀请码不再死板绑定特定 Team，而是作为“入场券”，使用时动态分配资源。
-   **灵活类型**：
    -   **永久邀请码**：长期有效，适合长期成员。
    -   **临时邀请码（1 日）**：有效期 24 小时，到期后系统会自动将成员踢出（管理员可在后台“确认”以转正）。
-   **无限生成**：支持批量生成、无限数量，支持重复使用。

### 3. 🤖 自动踢人与成员管理

全自动化的成员生命周期管理，保护账号安全：

-   **非法成员清理**：定期（可配置）扫描 Team 成员列表，自动踢出未通过系统邀请的“偷渡”成员。
-   **过期清理**：自动识别并踢出过期的临时邀请成员。
-   **拟人化运行**：
    -   **随机间隔**：检测间隔在设定范围内随机波动（如 90-120 秒）。
    -   **作息模拟**：支持设置运行时间段（如 09:00 - 22:00），夜间自动休眠。
-   **手动干预**：管理员可在后台手动邀请、踢人、查看详细日志。

### 4. 🛡️ 安全与防护机制

-   **账号安全识别**：
    -   **Token 监控**：自动检测 Token 有效性，遇到 401 错误自动标记过期并预警。
    -   **智能更新**：添加 Team 时，通过 `organization_id` 自动识别已存在的组织，自动更新 Token 而非重复创建。
-   **系统防护 (Fail2Ban)**：
    -   管理员登录防爆破：30 分钟内连续 5 次密码错误，自动封禁 IP 30 分钟。
-   **反指纹追踪**：
    -   内置 `curl_cffi` 库，模拟真实 Chrome 浏览器指纹（JA3/TLS 指纹），极大降低 API 调用被 ChatGPT 官方拦截的风险。

---

## 📖 使用指南

### 1️⃣ 添加/更新 Team

1. 登录 ChatGPT 官网，访问 `https://chatgpt.com/api/auth/session` 获取 JSON。
2. 在管理后台 **"➕ 添加新 Team"** 处粘贴 JSON。
    - **新增**：系统会自动解析并创建新 Team。
    - **更新**：如果该组织已存在，系统会自动更新其 Token 和名称，不会产生重复数据。

### 2️⃣ 生成邀请码

1. 进入 **"🔑 邀请码池"**。
2. 点击 **"生成邀请码"**。
    - 选择数量（支持批量）。
    - 选择是否为“临时邀请”（1 日有效）。
3. 复制生成的邀请码发给用户。

### 3️⃣ 配置自动踢人

1. 在 **"🤖 自动踢人配置"** 卡片中。
2. 勾选 **"启用"**。
3. 设置检测间隔（建议 90-120 秒）和运行时间段。
4. 保存后，系统将在后台自动守护。

### 4️⃣ 用户加入

1. 用户访问系统首页。
2. 输入 **邮箱** 和 **邀请码**。
3. 系统自动处理加入请求，成功后用户查收邮件即可。

---

## ⚠️ 注意事项

-   **Team 人数上限**：每个 ChatGPT Team 只有 4 个席位（不含 Owner），满员后该 Team 将不再接受新成员分配。
-   **Token 过期**：ChatGPT 的 Session Token 有效期有限，请定期在后台检查 Token 状态。
-   **反爬虫策略**：虽然系统已做防护，但建议不要设置过短的自动踢人检测间隔（建议 >60 秒），以免触发官方限流。

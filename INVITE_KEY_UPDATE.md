# 邀请码功能更新说明

## 更新内容

### 1. 邀请码支持绑定指定Team

#### 后端逻辑 (`app_new.py`)
- **新增功能**：邀请码可选绑定特定Team
  - 如果邀请码有 `team_id`：用户只能加入该Team
  - 如果邀请码无 `team_id`：走原有的智能分配逻辑

#### 用户使用流程
```python
# 绑定Team的邀请码
if assigned_team_id:
    # 只尝试这一个Team
    # 检查Team是否存在、Token是否过期、是否已满
    
# 通用邀请码
else:
    # 原有逻辑：智能选择可用Team，最多尝试3次
```

### 2. Teams列表增加"邀请码"按钮

#### 前端界面 (`admin_new.html`)
- 每个Team卡片新增"邀请码"按钮
- 点击后弹出选择框：
  1. 确认是否生成
  2. 选择类型（1日试用 / 永久）
- 生成后自动复制到剪贴板

#### 新增函数
```javascript
async function generateTeamKey(teamId, teamName) {
    // 生成指定Team的专属邀请码
    // 自动复制到剪贴板
    // 刷新邀请码列表
}
```

### 3. 邀请码列表显示优化

#### 界面改进 (`keys_list.html`)
- **绑定Team的邀请码**：显示紫色标签 + Team名称
- **通用邀请码**：显示灰色标签 + "通用邀请码"
- 使用徽章样式，更清晰直观

#### 显示效果
```
🔑 专属邀请码: [⚡ Team名称] [1日试用/永久] [使用 0 次]
🔑 通用邀请码: [🔧 通用邀请码] [1日试用/永久] [使用 0 次]
```

## 使用场景

### 场景1：为特定Team生成专属邀请码
1. 管理后台 → Teams列表
2. 找到目标Team → 点击"邀请码"按钮
3. 选择类型（试用/永久）
4. 邀请码自动生成并复制
5. 用户使用该邀请码只能加入该Team

### 场景2：生成通用邀请码
1. 管理后台 → 邀请码管理 → 新增
2. 不选择Team（team_id为空）
3. 系统自动智能分配可用Team

## 数据库字段

已有字段 `access_keys.team_id`：
- **NULL**：通用邀请码（智能分配）
- **数字**：绑定指定Team的专属邀请码

## 向后兼容

- ✅ 现有通用邀请码逻辑不变
- ✅ 现有数据库结构无需修改
- ✅ 所有旧邀请码继续有效

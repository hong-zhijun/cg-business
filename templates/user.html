<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>åŠ å…¥ ChatGPT Team</title>
        <link rel="stylesheet" href="/static/style.css" />
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            primary: "#2563eb",
                        },
                    },
                },
            };
        </script>
    </head>
    <body class="min-h-screen bg-gray-50 text-gray-800">
        <div class="max-w-2xl mx-auto px-4 sm:px-6 py-6 sm:py-10">
            <div
                class="bg-white rounded-2xl shadow-sm border border-gray-200 p-4 sm:p-6"
            >
                <h1 class="text-xl sm:text-2xl font-bold text-gray-900">
                    ğŸš€ åŠ å…¥ ChatGPT Team
                </h1>
                <p class="text-gray-500 text-xs sm:text-sm mt-1">
                    è¾“å…¥æ‚¨çš„é‚®ç®±å’Œè®¿é—®å¯†é’¥å³å¯åŠ å…¥å›¢é˜Ÿ
                </p>

                <form id="joinForm" class="mt-4 sm:mt-6 space-y-3 sm:space-y-4">
                    <div>
                        <label
                            for="email"
                            class="block text-xs sm:text-sm font-medium text-gray-700 mb-1"
                            >ğŸ“§ é‚®ç®±åœ°å€</label
                        >
                        <input
                            type="email"
                            id="email"
                            name="email"
                            placeholder="your@email.com"
                            required
                            class="w-full px-3 sm:px-4 py-2.5 sm:py-2 text-sm sm:text-base rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-colors"
                        />
                    </div>

                    <div>
                        <label
                            for="key_code"
                            class="block text-xs sm:text-sm font-medium text-gray-700 mb-1"
                            >ğŸ”‘ è®¿é—®å¯†é’¥</label
                        >
                        <input
                            type="text"
                            id="key_code"
                            name="key_code"
                            placeholder="è¾“å…¥æ‚¨è·å¾—çš„è®¿é—®å¯†é’¥"
                            required
                            class="w-full px-3 sm:px-4 py-2.5 sm:py-2 text-sm sm:text-base rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-colors"
                        />
                    </div>

                    <button
                        type="submit"
                        class="w-full sm:w-auto inline-flex items-center justify-center px-5 sm:px-4 py-2.5 sm:py-2 text-sm sm:text-base bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-sm transition-colors font-medium"
                    >
                        åŠ å…¥å›¢é˜Ÿ
                    </button>
                </form>

                <div
                    id="message"
                    class="message mt-4"
                    style="display: none"
                ></div>
            </div>

            <div
                class="text-center text-xs sm:text-sm text-gray-500 mt-4 sm:mt-6 px-2"
            >
                <p>ğŸ’¡ æç¤ºï¼šè®¿é—®å¯†é’¥ç”±å›¢é˜Ÿç®¡ç†å‘˜æä¾›ï¼Œæ¯ä¸ªå¯†é’¥åªèƒ½ä½¿ç”¨ä¸€æ¬¡</p>
            </div>
        </div>

        <div
            id="confirmModal"
            class="fixed inset-0 z-50 bg-gray-900 bg-opacity-50 backdrop-blur-sm flex items-center justify-center min-h-screen"
            style="display: none"
        >
            <div
                class="relative bg-white rounded-xl shadow-2xl border border-gray-200 p-4 sm:p-6 w-full max-w-md mx-4"
            >
                <div class="flex justify-between items-center mb-3 sm:mb-4">
                    <h3 class="text-base sm:text-lg font-bold text-gray-900">
                        ç¡®è®¤
                    </h3>
                    <button
                        id="confirmClose"
                        class="text-gray-400 hover:text-gray-600 p-1"
                    >
                        <svg
                            class="w-5 h-5"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"
                            />
                        </svg>
                    </button>
                </div>
                <div
                    id="confirmMessage"
                    class="text-sm sm:text-base text-gray-700 whitespace-pre-line leading-relaxed"
                ></div>
                <div
                    class="flex flex-col-reverse sm:flex-row justify-end gap-2 sm:gap-3 mt-4 sm:mt-6"
                >
                    <button
                        id="confirmCancel"
                        class="w-full sm:w-auto px-4 py-2.5 sm:py-2 text-sm sm:text-base border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium"
                    >
                        å–æ¶ˆ
                    </button>
                    <button
                        id="confirmOk"
                        class="w-full sm:w-auto px-4 py-2.5 sm:py-2 text-sm sm:text-base bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium"
                    >
                        ç¡®å®š
                    </button>
                </div>
            </div>
        </div>

        <script>
            const form = document.getElementById("joinForm");
            const messageDiv = document.getElementById("message");

            form.addEventListener("submit", async (e) => {
                e.preventDefault();

                const email = document.getElementById("email").value.trim();
                const key_code = document
                    .getElementById("key_code")
                    .value.trim();

                if (!email || !key_code) {
                    showMessage("è¯·å¡«å†™æ‰€æœ‰å­—æ®µ", "error");
                    return;
                }

                // ç¡®è®¤é‚®ç®±æ˜¯å¦æ­£ç¡®
                const confirmMessage = `ğŸ“§ è¯·ç¡®è®¤æ‚¨çš„é‚®ç®±åœ°å€æ˜¯å¦æ­£ç¡®ï¼š

${email}

âš ï¸ é‚€è¯·é‚®ä»¶å°†å‘é€åˆ°æ­¤é‚®ç®±ï¼Œè¯·ä»”ç»†æ ¸å¯¹ï¼
å¦‚æœé‚®ç®±é”™è¯¯ï¼Œè¯·ç‚¹å‡»"å–æ¶ˆ"é‡æ–°è¾“å…¥ã€‚`;
                if (!(await showConfirm(confirmMessage))) {
                    return;
                }

                // ç¦ç”¨æŒ‰é’®
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.disabled = true;
                submitBtn.textContent = "å¤„ç†ä¸­...";

                try {
                    const response = await fetch("/api/join", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({ email, key_code }),
                    });

                    const data = await response.json();

                    if (data.success) {
                        showMessage(data.message, "success");
                        form.reset();

                        // æ˜¾ç¤ºé¢å¤–æç¤º
                        setTimeout(async () => {
                            if (
                                await showConfirm(
                                    "âœ… é‚€è¯·å·²å‘é€ï¼\n\næ˜¯å¦æ‰“å¼€é‚®ç®±æŸ¥çœ‹é‚€è¯·ï¼Ÿ"
                                )
                            ) {
                                window.open(
                                    "https://mail.google.com",
                                    "_blank"
                                );
                            }
                        }, 1000);
                    } else {
                        showMessage(data.error || "åŠ å…¥å¤±è´¥", "error");
                    }
                } catch (error) {
                    showMessage("ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•", "error");
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = "åŠ å…¥å›¢é˜Ÿ";
                }
            });

            function showMessage(text, type) {
                messageDiv.innerHTML = text.replace(/\n/g, "<br>");
                messageDiv.className = `message ${type}`;
                messageDiv.style.display = "block";

                if (type === "success") {
                    setTimeout(() => {
                        messageDiv.style.display = "none";
                    }, 10000);
                } else {
                    setTimeout(() => {
                        messageDiv.style.display = "none";
                    }, 5000);
                }
            }
            function showConfirm(msg) {
                return new Promise(function (resolve) {
                    var modalEl = document.getElementById("confirmModal");
                    var msgEl = document.getElementById("confirmMessage");
                    var okBtn = document.getElementById("confirmOk");
                    var cancelBtn = document.getElementById("confirmCancel");
                    if (!modalEl || !msgEl || !okBtn || !cancelBtn) {
                        var nativeConfirm = window.confirm;
                        resolve(nativeConfirm(String(msg)));
                        return;
                    }
                    msgEl.textContent = String(msg);
                    modalEl.style.display = "block";
                    function cleanup() {
                        okBtn.removeEventListener("click", onOk);
                        cancelBtn.removeEventListener("click", onCancel);
                        modalEl.removeEventListener("click", onOverlay);
                        var closeBtn = document.getElementById("confirmClose");
                        if (closeBtn)
                            closeBtn.removeEventListener("click", onCancel);
                    }
                    function onOk(e) {
                        e.stopPropagation();
                        cleanup();
                        modalEl.style.display = "none";
                        resolve(true);
                    }
                    function onCancel(e) {
                        e.stopPropagation();
                        cleanup();
                        modalEl.style.display = "none";
                        resolve(false);
                    }
                    function onOverlay(e) {
                        if (e.target && e.target.id === "confirmModal") {
                            cleanup();
                            modalEl.style.display = "none";
                            resolve(false);
                        }
                    }
                    okBtn.addEventListener("click", onOk);
                    cancelBtn.addEventListener("click", onCancel);
                    var closeBtn = document.getElementById("confirmClose");
                    if (closeBtn) closeBtn.addEventListener("click", onCancel);
                    modalEl.addEventListener("click", onOverlay);
                });
            }
        </script>
    </body>
</html>

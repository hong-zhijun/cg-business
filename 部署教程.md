# ChatGPT Team 管理系统部署教程

本文档旨在指导如何在 Linux 服务器上部署 ChatGPT Team 管理系统。

## 1. 环境要求

- **操作系统**: Linux (推荐 Ubuntu 20.04+, Debian 10+, CentOS 7+)
- **Python**: Python 3.6+
- **权限**: 需要 root 权限或 sudo 权限

## 2. 快速部署 (推荐)

本项目提供了一键部署脚本 `deploy.sh`，可自动完成依赖安装、环境配置和服务启动。

### 部署步骤

1.  **上传代码**
    将项目代码上传至服务器任意目录（例如 `/root/chagpt-main`）。

2.  **赋予执行权限**
    ```bash
    chmod +x deploy.sh
    ```

3.  **运行部署脚本**
    ```bash
    sudo ./deploy.sh
    ```
    或者，如果你想自定义管理员密码运行（推荐）：
    ```bash
    export ADMIN_PASSWORD="你的强密码"
    sudo -E ./deploy.sh
    ```

### 脚本执行内容
脚本会自动执行以下操作：
- 安装系统级依赖 (`python3`, `python3-pip`)。
- 创建项目安装目录 `/opt/chatgpt-team` 并复制文件。
- 安装 Python 依赖 (`requirements_new.txt`)。
- 创建并启动 systemd 服务 (`chatgpt-team.service`)。

## 3. 配置说明

系统配置主要定义在 `config.py` 中，支持通过环境变量覆盖。

### 主要配置项

| 配置项 | 环境变量 | 默认值 (脚本部署) | 默认值 (源码运行) | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| **管理员密码** | `ADMIN_PASSWORD` | `Moyu123456@` | `123456` | 管理后台登录密码 |
| **服务端口** | `PORT` | `5002` | `5002` | Web 服务监听端口 |
| **主机地址** | `HOST` | - | `0.0.0.0` | 监听地址 |
| **密钥** | `SECRET_KEY` | (随机) | (随机) | Flask Session 加密密钥 |

> **注意**：使用 `deploy.sh` 部署时，默认管理员密码被设置为 **`Moyu123456@`**（见脚本第 56 行），而不是 `config.py` 中的 `123456`。请务必在部署后修改或在部署时指定。

### 修改配置

如果需要修改配置（如端口或密码），请编辑 systemd 服务文件：

1.  编辑服务文件：
    ```bash
    nano /etc/systemd/system/chatgpt-team.service
    ```
2.  修改 `Environment` 行：
    ```ini
    [Service]
    ...
    Environment="ADMIN_PASSWORD=新密码"
    Environment="PORT=5002"
    ...
    ```
3.  重载配置并重启服务：
    ```bash
    systemctl daemon-reload
    systemctl restart chatgpt-team
    ```

## 4. 服务管理

使用 `systemctl` 管理服务：

- **查看状态**:
  ```bash
  systemctl status chatgpt-team
  ```
- **启动服务**:
  ```bash
  systemctl start chatgpt-team
  ```
- **停止服务**:
  ```bash
  systemctl stop chatgpt-team
  ```
- **重启服务**:
  ```bash
  systemctl restart chatgpt-team
  ```
- **查看实时日志**:
  ```bash
  journalctl -u chatgpt-team -f
  ```

## 5. 访问地址

部署成功后，服务默认监听 `5002` 端口。

- **用户端**: `http://<服务器IP>:5002/`
- **管理后台**: `http://<服务器IP>:5002/admin`

## 6. 注意事项

1.  **防火墙设置**: 请确保云服务器的安全组或防火墙已放行 **5002** 端口 (TCP)。
2.  **数据备份**: 数据库文件位于 `/opt/chatgpt-team/chatgpt_team.db`，请定期备份此文件以防数据丢失。
3.  **HTTPS**: 生产环境建议配置 Nginx 反向代理并开启 HTTPS。

---
**Nginx 反向代理示例 (可选)**:

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:5002;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```
